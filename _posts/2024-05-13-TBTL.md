---
title: TBTL 2024
date: 2024-05-13 09:44:30
categories: [WRITEUPS]
math: true
---

# TBTL

This particular CTF is organized by the employees of TBTL (The Blockhouse Technology Limited) Zagreb, with the main goal being connecting with talent in Croatia that has an interest in the field of cybersecurity.

## Index

- crypto 5
  - [fence building](#fence-building-100pts) (100pts)
  - [school esasy](#school-esasy-100pts) (100pts)
  - university paper (100pts)
  - wikipedia signatures (100pts)
  - kung fu cipher (337 pts)
- pwn 2
  - a day at the races (100pts)
  - enough with the avarages (100pts)
- web 2
  - butterfly (100pts)
  - talk to you (100 pts)

## Fence building (100pts)

**Description:** I've recently got into woodworking and have build a beautiful fence just like [this one](https://en.wikipedia.org/wiki/Split-rail_fence).
Now I'm working on a flag, but it turns out all garbled for some reason...

{: .prompt-tip }

> T0n40g5BG03cmk0D1hr}T{dFe_3g_3buL_5_n0

So as u can see, this chall gives us a string that resambles a flag and a little hint on what it's used to encrypt the flag, visiting the link u can find some reference to the Toggle the table of contents
Split-rail fence and at this point is pretty straightforward, it's the fence cypher, we put the flag in an online decoder and we try some values to obtain the plaintext.

![fence_decryption](/assets/img/tbtl2024/fence.png)

{: .prompt-tip }

> flag: TBTL{G00d_F3nce5_m4k3_g00D_n31ghb0ur5}

## school esasy (100pts)

**Description:** I had to write an essay for school describing my favorite classmate. I wonder if my classmates will be able to figure out who I'm describing...

This challs provides us two files a **.py** that does a binary search on the condition $$ x^3 < y^2 $$ and a **.txt** with the values that we need to find.
What we need to do is find the correct $$ y\ |\ y^2\ = value\\\_1\ \land \ y=flag\ \land \ x^3 < y^2 $$

```python
from Crypto.Util.number import
from redacted import FLAG

ESSAY_TEMPLATE = """
My Favorite Classmate
=====================

My favorite person in this class has a beautiful smile,
great sense of humour, and lots of colorful notebooks.

However, their most distinctive feature is the fact that
you can represent their name as an integer value, square
it modulo %d,
and you'll get %d.

Additionally, When you compute the greatest integer not exceeding
the cube root of their squared name, you get %d.

By now, all of you have probably guessed who I'm talking about.
"""

def invpow3(x):
lo, hi = 1, x
while lo < hi:
  mid = (lo + hi) // 2 + 1
  if (mid**3) <= x:
    lo = mid
  else:
    hi = mid - 1
return lo

N = 59557942237937483757629838075432240015613811860811898821186897952866236010569299041278104165604573

name_int = bytes_to_long(FLAG)

assert 1 < name_int < N

value_1 = (name_int**2) % N
value_2 = invpow3(name_int**2)

print(ESSAY_TEMPLATE % (N, value_1, value_2))
```

the values provided are:

$$
\begin{align}
& y ^ 2 \ mod \ N = 34994952631013563439857468985559745199379391295940238707110695903159545061311344766055629477728657 \\
& x ^ 3= 7906488397402721714607879953738472269409876715324979164781592447 \\
& N = 59557942237937483757629838075432240015613811860811898821186897952866236010569299041278104165604573
\end{align}
$$

Let's break down what we have $$ N $$ is the modulo it's prime [factor.db](http://www.factordb.com/) ,so we can use [tonelli shanks](https://en.wikipedia.org/wiki/Tonelli%E2%80%93Shanks_algorithm) to find such y simple right?

```python
from sympy import \*
from Crypto.Util.number import long_to_bytes as l2b

y_squared = 34994952631013563439857468985559745199379391295940238707110695903159545061311344766055629477728657
N = 59557942237937483757629838075432240015613811860811898821186897952866236010569299041278104165604573

for i in nthroot_mod(y_squared,2,N,all_roots=True):
  print(l2b(i))
```

![tonelli](/assets/img/tbtl2024/tonelli.png)

{: .prompt-tip }

> flag: TBTL{J0hn_J4c0b_J1n6leH31mer_Schm1d7\_<3}

## university paper (100pts)

**Description:** I had to write a scientific paper for one of my university courses describing my scientific role model. I wonder if my professors will be able to figure out who I'm describing...

```
from Crypto.Util.number import *
from redacted import FLAG

ESSAY_TEMPLATE = """
On the Estemeed Scientifc Role Model of Mine
============================================

Within the confines of this academic setting, the individual whom
I hold in highest regard not only boasts an engaging smile but also
possesses a remarkable sense of humor, complemented by an array of
vibrant notebooks.

Yet, it is their distinct quantifiable attribute that stands out
most prominently: their name, when converted into an integer value
and squared modulo %d,
astonishingly results in %d.

Furthermore, the greatest integer that does not surpass the cube root
of the aforementioned squared name equals %d.
This computational detail adds another layer of distinction.

It is likely that by this point, many of you have discerned the identity
of this distinguished role model.
"""


def invpow3(x):
    lo, hi = 1, x
    while lo < hi:
        mid = (lo + hi) // 2 + 1
        if (mid**3) <= x:
            lo = mid
        else:
            hi = mid - 1
    return lo


N = 13113180816763040887576781992067364636289723584543479342139964290889855987378109190372819034517913477911738026253141916115785049387269347257060732629562571

name_int = bytes_to_long(FLAG)

assert 1 < name_int < N

value_1 = (name_int**2) % N
value_2 = invpow3(name_int**2)

assert (value_2**3) <= (name_int**2)
assert ((value_2 + 2) ** 3) > (name_int**2)

print(ESSAY_TEMPLATE % (N, value_1, value_2))
```

I don't want to waste time repeating what i wrote up, this is pratically the same challenge of above but this time $$ N $$ is not prime, is a composite number that means we can't use tonelli-shanks we need something more powerful because finding the solution of
$$y^2 = a \mod\ N $$ when $$ N $$ is not prime is considered to be a problem equal to the **factorization** that is an **hard** problem.

what we can do?

The first thing that went to my mind was we can have a good approximation of what is our target number y cause we can do a binary search on the binary search **a lil tricky i'll explain laiter** and recover an $$z \simeq y $$ .

what is a binary search over binary search ?

we can apply the binary search because we have a function $$ f $$ that is monotone

$$ \forall i,j\ | \ i<j \ f(i)\ \theta \ f(j) \theta = < > $$
